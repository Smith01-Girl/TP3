
FROM openjdk:17-ea-slim AS build
WORKDIR /app

COPY .mvn/ .mvn
COPY mvnw ./
COPY pom.xml ./
RUN ./mvnw dependency:go-offline

COPY src/ ./src
RUN ./mvnw clean package -DskipTests -Pprod


FROM openjdk:17-ea-slim
WORKDIR /app

# Utilisateur non-root
RUN addgroup --system spring && adduser --system spring --ingroup spring
USER spring:spring

COPY --from=build /app/target/*.jar app.jar

EXPOSE 8080

# SANS port debug
ENTRYPOINT ["java", \
    "-Xms256m", \
    "-Xmx512m", \
    "-Dspring.profiles.active=prod", \
    "-jar", \
    "app.jar"]